<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Haven&Her – To Support Someone</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600&family=Inter:wght@400;500&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #f2f6fb;
      --card-bg: #ffffff;

      --text-main: #1f2a37;
      --text-sub: #4b5563;

      --accent: #4f7fd6;
      --accent-soft: #dbe6fb;
      --border-soft: #e3ebf8;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      height: 100vh;
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text-main);

      display: flex;
      flex-direction: column;
      align-items: center;

      overflow: hidden;
    }

    /* background shapes */
    .bg-shape,
    .bg-shape-2 {
      position: absolute;
      border-radius: 50%;
      background: var(--accent-soft);
      z-index: -1;
    }

    .bg-shape {
      width: 420px;
      height: 420px;
      top: -120px;
      left: -120px;
    }

    .bg-shape-2 {
      width: 360px;
      height: 360px;
      bottom: -160px;
      right: -160px;
    }

    /* navbar */
    .navbar {
      width: 100%;
      background: rgba(242,246,251,0.9);
      backdrop-filter: blur(8px);
      border-bottom: 1px solid var(--border-soft);
    }

    .navbar-inner {
      padding: 18px 24px;
      display: flex;
      align-items: center;
    }

    .nav-brand {
      font-family: 'Playfair Display', serif;
      font-size: 30px;
    }

    /* page layout */
    .page {
  height: calc(100vh - 72px); /* navbar height */
  width: 100%;
  max-width: 1200px;
  padding: 24px 40px;

  display: grid;
  grid-template-columns: 0.9fr 1.1fr;
  gap: 40px;
}


    /* left panel */
    .left {
      height: 100%;
      background: rgba(255,255,255,0.55);
      backdrop-filter: blur(6px);
      border-radius: 28px;
      padding: 40px;

      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .left h1 {
      font-family: 'Playfair Display', serif;
      font-size: 34px;
      line-height: 1.25;
      margin-bottom: 22px;
    }

    .left p {
      font-size: 16px;
      color: var(--text-sub);
      line-height: 1.6;
      margin-bottom: 18px;
    }

    .divider {
      width: 70px;
      height: 2px;
      background: var(--accent);
      opacity: 0.5;
      margin-top: 24px;
    }

    /* right panel */
    .right {
  height: 100%;
  display: flex;
  flex-direction: column;
  gap: 24px;
  position: relative;
  height:530px;
}

    .respond-section {
  margin-bottom: 28px;
}

textarea {
  width: 100%;
  min-height: 44px;
  max-height: 160px;
  padding: 12px 16px;
  border-radius: 16px;
  border: 1px solid var(--border-soft);
  font-family: 'Inter', sans-serif;
  font-size: 14px;
  background: rgba(255,255,255,0.95);
  resize: none;
  outline: none;
  overflow: hidden;
  transition: border 0.2s ease;
}

textarea:focus {
  border-color: var(--accent);
}

.ai-soft-btn {
  margin-top: 12px;
  padding: 10px 18px;
  border-radius: 18px;
  border: none;
  background: var(--accent);
  color: white;
  cursor: pointer;
  font-size: 14px;
}

.ai-response {
  margin-top: 16px;
  padding: 20px;
  border-radius: 18px;
  background: rgba(79,127,214,0.15);
  line-height: 1.6;
  font-size: 15px;
  min-height: 80px;
}




    .card {
  flex: 1;                 /* THIS LINE FIXES EVERYTHING */
  min-height: 0;           /* prevents overflow bugs */
  background: var(--card-bg);
  border-radius: 22px;
  border: 1px solid var(--border-soft);
  overflow: hidden;
  cursor: pointer;

  display: flex;
  flex-direction: column;

  transition: transform 0.25s ease, box-shadow 0.25s ease;
}


    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 14px 28px rgba(79,127,214,0.22);
    }

    .card img {
  height: 120px;
  width: 100%;
  object-fit: cover;
  flex-shrink: 0;
}



    .card-content {
      flex: 1;
      padding: 28px 24px;
      text-align: center;

      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .card-content h3 {
      font-size: 20px;
      margin-bottom: 10px;
      font-weight: 500;
    }

    .card-content p {
      font-size: 14px;
      color: var(--text-sub);
    }

    /* overlay */
    .expanded-content {

      position: absolute;
      inset: 0;
      background: rgba(255,255,255,0.97);
      border-radius: 22px;
      padding: 40px;

      opacity: 0;
      pointer-events: none;
      transform: translateY(12px);
      transition: all 0.3s ease;
    }

    .expanded-content.active {

      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }

    .expanded h2 {
      font-family: 'Playfair Display', serif;
      font-size: 28px;
      margin-bottom: 16px;
    }
    .expanded-inner {
  position: relative;
  z-index: 2;
  padding: 40px;
  height: 100%;
  overflow-y: auto;
}

    .expanded p {
      font-size: 16px;
      line-height: 1.7;
      color: var(--text-sub);
      margin-bottom: 14px;
      max-width: 640px;
    }.profile-container {
  position: relative;
  cursor: pointer;
}

.profile-circle {
  width: 42px;
  height: 42px;
  border-radius: 50%;
  background: var(--accent);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  font-size: 18px;
  text-transform: uppercase;
}

.profile-dropdown {
  position: absolute;
  top: 55px;
  right: 0;
  background: white;
  border-radius: 12px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.08);
  padding: 10px;
  display: none;
}

.profile-dropdown button {
  background: none;
  border: none;
  padding: 8px 16px;
  cursor: pointer;
  width: 100%;
  text-align: left;
}

    .back-btn {
      background: none;
      border: none;
      color: var(--accent);
      font-size: 14px;
      cursor: pointer;
      margin-bottom: 28px;
    }

    @media (max-width: 900px) {
      .page {
        grid-template-columns: 1fr;
      }
    }

  </style>
</head>

<body>

  <div class="bg-shape"></div>
  <div class="bg-shape-2"></div>

  <nav class="navbar">
    <div class="navbar-inner" style="display:flex; justify-content:space-between; align-items:center;">
      <div class="nav-brand">Haven&Her</div>

      <div class="profile-container">
        <div class="profile-circle" id="profileCircle"></div>
        <div class="profile-dropdown" id="profileDropdown">
          <button onclick="logout()">Logout</button>
        </div>
      </div>
    </div>
  </nav>


  <div class="page">

    <!-- LEFT -->
    <div class="left">
      <h1>Support starts with noticing.</h1>
      <p>
        When someone you care about is struggling,
        it isn’t always obvious or clearly explained.
      </p>
      <p>
        This space helps you respond thoughtfully —
        without dismissing, fixing, or overreacting.
      </p>
      <div class="divider"></div>
    </div>

    <!-- RIGHT -->
    <div class="right" id="cards">

      <div class="card" onclick="openCard('notice')">
        <img src="supportsee.png" alt="Noticing change">
        <div class="card-content">
          <h3>What I’m Noticing</h3>
          <p>Understand what her behaviour may be signalling</p>
        </div>
      </div>

      <div class="card" onclick="openCard('act')">
        <img src="helpthem.png" alt="Responding with care">
        <div class="card-content">
          <h3>What to Do Now</h3>
          <p>Respond in a way that actually helps</p>
        </div>
      </div>

      <!-- Overlay -->
      <div class="expanded-content" id="expandedContent">

  <div class="expanded-bg" id="expandedBg"></div>

  <div class="expanded-inner">
    <button class="back-btn" onclick="closeCard()">← Back</button>
    <div id="expandedBody"></div>
  </div>

</div>


    </div>

  </div>


<script type="module">

/* ------------------- IMPORTS ------------------- */
import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut }
from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";


/* ------------------- GEMINI ------------------- */
const genAI = new GoogleGenerativeAI("AIzaSyC_QMze2rwPX4WdlgGhcTHNYIOiUusQgdI");
const model = genAI.getGenerativeModel({ model: "gemini-2.5-flash" });


/* ------------------- FIREBASE ------------------- */
const firebaseConfig = {
  apiKey: "AIzaSyBXEUA6m10uR0-pTV4IewWmUxTVU-_8cfs",
  authDomain: "h-h-v1.firebaseapp.com",
  projectId: "h-h-v1",
  storageBucket: "h-h-v1.firebasestorage.app",
  messagingSenderId: "786859596243",
  appId: "1:786859596243:web:f0918769de98fda7f43726",
  measurementId: "G-LGTXYGKNFH"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

const profileCircle = document.getElementById("profileCircle");
const profileDropdown = document.getElementById("profileDropdown");


/* ------------------- PAGE PROTECTION ------------------- */
onAuthStateChanged(auth, (user) => {
  if (!user) {
    window.location.replace("login.html");
    return;
  }

  const mode = localStorage.getItem("mode");
  const ageGroup = localStorage.getItem("ageGroup");

  if (mode !== "support" ) {
  window.location.replace("setup.html");
  return;
}

  const name = user.displayName || user.email;
  profileCircle.textContent = name.charAt(0).toUpperCase();
});



/* ------------------- LOGOUT ------------------- */
window.logout = function() {
  signOut(auth).then(() => {
    window.location.href = "index.html";
  });
};


/* ------------------- PROFILE DROPDOWN ------------------- */
if (profileCircle) {
  profileCircle.addEventListener("click", () => {
    profileDropdown.style.display =
      profileDropdown.style.display === "block" ? "none" : "block";
  });
}

window.addEventListener("click", (e) => {
  if (!e.target.closest(".profile-container")) {
    profileDropdown.style.display = "none";
  }
});


/* ------------------- STATIC CONTENT (UNCHANGED) ------------------- */
const data = {
 notice: `
<h2>What I’m Noticing</h2>

<div class="respond-section">
  <p>
    Withdrawal, irritability, exhaustion,
    or emotional distance often signal overload or discomfort.
  </p>
  <p>
    These behaviours usually reflect struggle —
    not attitude or unwillingness.
  </p>
</div>

<div class="respond-section">
  <textarea id="teenNoticeInput"
    placeholder="Describe what you're noticing..."></textarea>

  <button id="teenNoticeBtn" class="ai-soft-btn">
    Help me understand
  </button>
</div>

<div class="respond-section">
  <div id="teenNoticeResponse" class="ai-response"></div>
</div>
`,


  act: `
<h2>What to Do Now</h2>

<div class="respond-section">
  <p>
    Stay calm. Listen without correcting.
    Reduce pressure wherever possible.
  </p>
  <p>
    If concern continues, gently suggest
    rest or professional support —
    without forcing or blaming.
  </p>
</div>

<div class="respond-section">
  <textarea id="teenRespondInput"
    placeholder="Describe the situation..."></textarea>

  <button id="teenRespondBtn" class="ai-soft-btn">
    Help me respond
  </button>
</div>

<div class="respond-section">
  <div id="teenRespondResponse" class="ai-response"></div>
</div>
`
};


/* ------------------- CARD LOGIC ------------------- */
function openCard(key) {
  document.getElementById("expandedBody").innerHTML = data[key];
 document.getElementById("expandedContent").classList.add("active");
  document.getElementById("cards").style.pointerEvents = "none";
  
  document.getElementById("cards").style.opacity = "1";

}

function closeCard() {
  document.getElementById("expandedContent").classList.remove("active");
  document.getElementById("cards").style.pointerEvents = "auto";
  document.getElementById("cards").style.opacity = "0.2";

}

window.openCard = openCard;
window.closeCard = closeCard;

document.addEventListener("keydown", function (e) {

  // Notice input
  const noticeBox = document.getElementById("teenNoticeInput");
  if (noticeBox && e.target === noticeBox && e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    document.getElementById("teenNoticeBtn").click();
  }

  // Respond input
  const respondBox = document.getElementById("teenRespondInput");
  if (respondBox && e.target === respondBox && e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    document.getElementById("teenRespondBtn").click();
  }

});

/* ------------------- GEMINI LOGIC ------------------- */
document.addEventListener("click", async function(e) {

  /* -------- NOTICE -------- */
  if (e.target && e.target.id === "teenNoticeBtn") {

    const input = document.getElementById("teenNoticeInput").value;
    const output = document.getElementById("teenNoticeResponse");

    if (!input.trim()) {
      output.innerHTML = "Please describe what you're noticing first.";
      return;
    }

    output.innerHTML = "Thinking…";

    const relation = localStorage.getItem("relation") || "family member";

    const result = await model.generateContent(`
You are inside a teen support app.

The user is a ${relation}.
The girl is in her teenage years.

Interpret the behaviour described.

Do not diagnose.
Do not exaggerate.
Keep it emotionally grounded.

Explain briefly:
1. What this behaviour may signal.
2. One emotional factor.
3. One reminder for the supporter.

Situation:
${input}
`);

 const text = result.response.text();

const formatted = text
  .replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>")
  .replace(/\n/g, "<br>");

output.innerHTML = formatted;

  }


  /* -------- RESPOND -------- */
  if (e.target && e.target.id === "teenRespondBtn") {

    const input = document.getElementById("teenRespondInput").value;
    const output = document.getElementById("teenRespondResponse");

    if (!input.trim()) {
      output.innerHTML = "Please describe the situation first.";
      return;
    }

    output.innerHTML = "Thinking…";

    const relation = localStorage.getItem("relation") || "family member";

    const result = await model.generateContent(`
You are inside a teen support app.

The user is a ${relation}.
The girl is a teenager.

Give:
1. One calm opening sentence.
2. One tone reminder.
3. One short phrase to avoid.

Do not lecture.
Do not shame.
Keep it natural.

Situation:
${input}
`);

    const text = result.response.text();

const formatted = text
  .replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>")
  .replace(/\n/g, "<br>");

output.innerHTML = formatted;

  }

});


</script>
</body>
</html>







